# vim: ft=sh:
# Shell environment configuration sourced for both bash and zsh

# -------
# Environment Variables

# 
export LEDGER_FILE="$HOME/Data/Projects/Accounting/2020.journal"

# Use neovim for manpages
export MANPAGER='nvim +Man!'


# -------
# Aliases

# NixOS
# Test a nixos configuration, but leave the result symlink in a standard place
alias nixos-test='cd /etc/nixos/; sudo nixos-rebuild test'
# Remove symlink from test, switch to new configuration
alias nixos-switch='rm -f /etc/nixos/result; sudo nixos-rebuild switch'

# Systemd
alias sctl="sudo systemctl"
alias uctl="systemctl --user"
alias jctl="journalctl"

# terminal utils
alias dtrx="dtrx --one=I"
alias ls=exa

alias vim=nvim
# *E*ditor
alias e='$EDITOR'
# *E*dit *F*ile/*F*uzzy
alias fe='vim $(fd -H --type f | fzf)'
# *E*dit *R*ecent
alias fr='vim $(fzf)'
# *H*istory
#alias fh='print -z $(history|fzf)'
# alias fh='print -z $(history | fzf | tr -s " " | cut -d" " -f3- )'
# *R*un command
alias fr='dmenu_path | fzf --bind "enter:execute({})+abort"'

alias fx='$(fd -H --type x | fzf)'

alias fcd='cd "$(fd -t d | fzf)"'

alias open="xdg-open"

function mkcd () {
  mkdir "$1"; cd "$1";
}

# Open man pages with fzf
function fman() {
    man -k . | fzf -q "$1" --prompt='man> '  --preview $'echo {} | tr -d \'()\' | awk \'{printf "%s ", $2} {print $1}\' | xargs -r man' | tr -d '()' | awk '{printf "%s ", $2} {print $1}' | xargs -r man;
}

# FZF History
# print -z pushes the arguments onto the editing buffer stack
fh() {
  print -z "$( history | fzf +s --tac | sed -E 's/ *[0-9]*\*? *//' | sed -E 's/\\/\\\\/g')"
}

# FZF Bookmarks
# Add a bookmark
alias ba='pwd>>~/.bookmarks'
# Jump to bookmark
b() {
  local dest=$(fzf < ~/.bookmarks)
  if [[ $dest != '' ]]; then
    cd "$dest"
  fi
}
